# shellcheck disable=SC2034
# --- Options --- #
set -g default-terminal "tmux-256color"
set -g xterm-keys on

# Enable RGB + hyperlinks properly
set -as terminal-features ",xterm-256color:RGB"
set -as terminal-features ",tmux-256color:RGB"
set -as terminal-features ",xterm-256color:hyperlinks"
set -as terminal-features ",tmux-256color:hyperlinks"
set -as terminal-features ",xterm-kitty:RGB"
set -as terminal-features ",xterm-kitty:hyperlinks"

# Enable mouse support
set -g mouse on

set -g allow-passthrough on # Let modern terminal sequences (e.g. OSC-8 hyperlinks) pass through
set -g focus-events on      # Notify apps when pane/window gains or loses focus

# Set tmux plugin manager path
set-environment -g TMUX_PLUGIN_MANAGER_PATH "${XDG_DATA_HOME}/tmux/plugins"

# Start window/pane numbering from 1
set -g base-index 1
set -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on

# Shell auto-renaming windows
set -g allow-rename on

# Rename windows automatically
set -g automatic-rename on

# Clipboard settings
set-option -s set-clipboard on # Enable clipboard integration
# --- Options End --- #

# --- Keybinds --- #
# --- Prefix Key --- #
unbind C-b
set -g prefix C-space
bind C-space send-prefix

# --- Window / Tab Management --- #
# New tab/window
bind 't' new-window -c "#{pane_current_path}" # Prefix + t → new tab/window (kitty_mod+t)

bind 'w' kill-window  # Prefix + w → close tab/window (ctrl+w)
bind 'W' kill-session # Prefix + Shift+w → close OS window (kitty_mod+w)

# Rename current tab/window
bind 'r' command-prompt -I "#W" "rename-window '%%'" # Prefix + r → set tab title (kitty_mod+r)

# Navigate tabs/windows
bind 'Right' next-window    # Prefix + Right → next tab (kitty_mod+right)
bind 'Left' previous-window # Prefix + Left → previous tab (kitty_mod+left)

bind 'N' next-window     # Prefix + 'N' → next tab (kitty_mod+right)
bind 'P' previous-window # Prefix + 'P' → previous tab (kitty_mod+left)

# --- Pane Management --- #
# Split panes (mirroring Kitty intuitive layout)
bind '|' split-window -h -c "#{pane_current_path}" # Prefix + | → horizontal split
bind '-' split-window -v -c "#{pane_current_path}" # Prefix + - → vertical split
bind 'H' select-pane -L                            # Prefix + H → move left
bind 'J' select-pane -D                            # Prefix + J → move down
bind 'K' select-pane -U                            # Prefix + K → move up
bind 'L' select-pane -R                            # Prefix + L → move right

# Resize with Ctrl + Shift + hjkl
bind -r 'h' resize-pane -L 5 # Prefix + h → resize pane left
bind -r 'j' resize-pane -D 5 # Prefix + j → resize pane down
bind -r 'k' resize-pane -U 5 # Prefix + k → resize pane up
bind -r 'l' resize-pane -R 5 # Prefix + l → resize pane right
bind 0 select-layout even-horizontal # Prefix + 0 → reset layout

# --- Layout Management --- #
bind 'L' next-layout # Prefix + L → next layout (kitty_mod+l)

# --- Miscellaneous --- #

# Reload config
bind 'R' source-file "${XDG_CONFIG_HOME}/tmux/tmux.conf" # Prefix + R → reload tmux config

# Ctrl+Shift arrow navigation (no prefix needed)
bind -n C-S-Left previous-window                   # Ctrl+Shift+Left → previous tab
bind -n C-S-Right next-window                      # Ctrl+Shift+Right → next tab
bind -n C-S-t new-window -c "#{pane_current_path}" # Ctrl+Shift+t → new tab/window

# --- Keybinds End --- #
# --- Plugins --- #
# List of plugins
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'catppuccin/tmux'

# Catppuccin options
set -g @catppuccin_flavor "mocha"
set -g @catppuccin_window_status_style "basic"
set -g @catppuccin_status_background "none"
# Disable rounded (powerline) separators -> square modules
set -g @catppuccin_status_left_separator "█"
set -g @catppuccin_status_right_separator "█"

# Make the status line pretty
set -g status on
set -g status-position bottom
set -g status-left ""
set -g status-right ""
set -g status-left-length 999
set -g status-right-length 999

# Add some modules
set -g status-right "#{E:@catppuccin_status_application}"
set -ag status-right "#{E:@catppuccin_status_session}"
set -ag status-right "#{E:@catppuccin_status_uptime}"

set -g @catppuccin_window_text ' #{window_name}'
set -g @catppuccin_window_current_text ' #{window_name}'

# Watches your tmux configuration file and automatically reloads it on change.
set -g @plugin 'b0o/tmux-autoreload'
set-option -g @tmux-autoreload-entrypoints 1

# Search for keybindings and custom commands with fzf.
set -g @plugin 'lost-melody/tmux-command-palette'

# Filter the current buffer by some text/pattern, very useful for viewing logs.
set -g @plugin 'MaximilianGaedig/tmux-filter' # press Prefix + F

# Use fzf to manage your tmux work environment!
set -g @plugin 'sainnhe/tmux-fzf' # More advanced features
TMUX_FZF_LAUNCH_KEY="f"

# Add a tree of current directory using Prefix + Tab
# set -g @plugin 'tmux-plugins/tmux-sidebar'
# set -g @sidebar-tree-command 'eza --all --color=always --long --icons --no-time --no-user --sort=name --group-directories-first'
# set -g @sidebar-tree 'e'        # Replace Prefix + Tab with Prefix + e
# set -g @sidebar-tree-width '50' # Sidebar width

# Smooth scrolling for tmux—makes scrolling easy to follow.
# set -g @plugin 'azorng/tmux-smooth-scroll'
# set -g @smooth-scroll-mouse "true" # Enable on mouse wheel scroll

# Plugin for opening highlighted selection directly from Tmux copy mode.
set -g @plugin 'tmux-plugins/tmux-open'

# Persists tmux environment across system restarts.
set -g @plugin 'tmux-plugins/tmux-resurrect'
# Continuous saving of tmux environment. Automatic restore when tmux is started.
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @continuum-restore 'on'      # Auto restore session
set -g @continuum-boot 'on'         # Start tmux server at boot
set -g @continuum-save-interval '5' # Autosave every 5 minutes

set -g @plugin 'tmux-plugins/tpm'
# --- Plugins End --- #

run "${XDG_DATA_HOME}/tmux/plugins/tpm/tpm"
